<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ’– ìš°ë¦¬ ë°˜ ìê¸°ì†Œê°œ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap');

  body {
    font-family: 'Nanum Pen Script', cursive;
    background-color: #ffe4e1; /* ë¶€ë“œëŸ¬ìš´ ë¶„í™ ë‹¨ìƒ‰ */
    padding: 20px;
    margin: 0;
    min-height: 100vh;
  }

  h1 {
    text-align: center;
    color: #ff6f91;
    font-size: 2.8rem;
    margin-bottom: 20px;
    text-shadow: 1px 1px 2px #fce4ec;
  }

  .input-container {
    background: #fff0f5;
    border-radius: 20px;
    padding: 20px;
    max-width: 480px;
    margin: 0 auto 30px;
    box-shadow: 0 5px 15px rgba(255,105,145,0.3);
  }

  input, textarea {
    width: 90%;
    padding: 10px;
    margin: 10px auto;
    border-radius: 15px;
    border: 2px solid #ffb6c1;
    display: block;
    font-size: 1.1rem;
    outline: none;
  }
  textarea {
    height: 70px;
    resize: none;
  }

  button {
    background-color: #ff6f91;
    border: none;
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
    padding: 10px 25px;
    border-radius: 25px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 10px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  button:hover {
    background-color: #ff4d72;
  }

  #introList {
    max-width: 960px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    max-height: 600px;
    overflow-y: auto;
    padding-bottom: 15px;
  }

  .card {
    background: #fff;
    border-radius: 25px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(255,105,145,0.2);
    position: relative;
    font-size: 1.15rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .card h3 {
    color: #ff6f91;
    margin: 0 0 6px 0;
  }

  .card p {
    margin: 4px 0;
    color: #555;
    word-break: keep-all;
  }

  .actions {
    margin-top: 12px;
    text-align: right;
  }

  .actions button {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 1.5rem;
    margin-left: 10px;
    transition: transform 0.15s ease;
  }

  .actions button:hover {
    transform: scale(1.2);
  }

  .like-btn {
    color: #ff6f91;
  }

  .delete-btn {
    color: #aaa;
  }

  .like-animate {
    animation: like-pop 0.4s ease forwards;
  }

  @keyframes like-pop {
    0% { transform: scale(1); color: #ff6f91; }
    50% { transform: scale(1.6); color: #ff416c; }
    100% { transform: scale(1); color: #ff6f91; }
  }

  /* ëª¨ë°”ì¼ ëŒ€ì‘: ì¹´ë“œ ìµœì†Œ í¬ê¸° ì¤„ì„ */
  @media (max-width: 600px) {
    #introList {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      max-height: 500px;
    }
  }
</style>
</head>
<body>

<h1>ìš°ë¦¬ ë°˜ ìê¸°ì†Œê°œ ğŸ’Œ</h1>

<div class="input-container">
  <input type="text" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="15" />
  <input type="text" id="hobbyInput" placeholder="ì·¨ë¯¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="30" />
  <input type="text" id="skillInput" placeholder="íŠ¹ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="30" />
  <textarea id="introInput" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì‘ì„±í•˜ì„¸ìš” (ìµœëŒ€ 100ì)" maxlength="100"></textarea>
  <button id="postBtn">ìê¸°ì†Œê°œ ì˜¬ë¦¬ê¸°</button>
</div>

<div id="introList"></div>

<!-- Firebase JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCtBTzq6aIgRzWDB2gfG2LBK19Y4TYCj4w",
    authDomain: "summer-memory-bc163.firebaseapp.com",
    databaseURL: "https://summer-memory-bc163-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "summer-memory-bc163",
    storageBucket: "summer-memory-bc163.firebasestorage.app",
    messagingSenderId: "1014179818008",
    appId: "1:1014179818008:web:4570325a33a90582d2b16d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let currentUserName = "";

  const postBtn = document.getElementById("postBtn");
  postBtn.addEventListener("click", () => {
    const name = document.getElementById("nameInput").value.trim();
    const hobby = document.getElementById("hobbyInput").value.trim();
    const skill = document.getElementById("skillInput").value.trim();
    const intro = document.getElementById("introInput").value.trim();

    if (!name) {
      alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }
    if (!hobby) {
      alert("ì·¨ë¯¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }
    if (!skill) {
      alert("íŠ¹ê¸°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }
    if (!intro) {
      alert("ìê¸°ì†Œê°œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!");
      return;
    }

    currentUserName = name;

    const newRef = push(ref(db, "introductions"));
    set(newRef, {
      name: name,
      hobby: hobby,
      skill: skill,
      intro: intro,
      likes: 0,
      likedBy: {},
      author: name
    });

    // ì…ë ¥ì°½ ì´ˆê¸°í™”
    document.getElementById("nameInput").value = "";
    document.getElementById("hobbyInput").value = "";
    document.getElementById("skillInput").value = "";
    document.getElementById("introInput").value = "";
  });

  function renderComments() {
    const listRef = ref(db, "introductions");
    const list = document.getElementById("introList");

    onValue(listRef, (snapshot) => {
      list.innerHTML = "";
      snapshot.forEach((childSnap) => {
        const data = childSnap.val();
        const id = childSnap.key;

        const card = document.createElement("div");
        card.classList.add("card");

        card.innerHTML = `
          <h3>${escapeHtml(data.name)}</h3>
          <p><b>ì·¨ë¯¸:</b> ${escapeHtml(data.hobby)}</p>
          <p><b>íŠ¹ê¸°:</b> ${escapeHtml(data.skill)}</p>
          <p><b>ìê¸°ì†Œê°œ:</b> ${escapeHtml(data.intro)}</p>
          <div class="actions">
            <button class="like-btn" title="ì¢‹ì•„ìš”" data-id="${id}">ğŸ‘ ${data.likes || 0}</button>
            <button class="delete-btn" title="ì‚­ì œ" data-id="${id}">ğŸ—‘ï¸</button>
          </div>
        `;

        list.appendChild(card);
      });

      // ì¢‹ì•„ìš” ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll(".like-btn").forEach(btn => {
        btn.onclick = async () => {
          if (!currentUserName) {
            alert("ë¨¼ì € ìê¸°ì†Œê°œë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”!");
            return;
          }
          const commentId = btn.getAttribute("data-id");
          const commentRef = ref(db, "introductions/" + commentId);
          const snapshot = await get(commentRef);
          if (snapshot.exists()) {
            const data = snapshot.val();
            if (data.likedBy && data.likedBy[currentUserName]) {
              alert("ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì…¨ì–´ìš”!");
              return;
            }
            const likedBy = data.likedBy || {};
            likedBy[currentUserName] = true;
            await update(commentRef, {
              likes: (data.likes || 0) + 1,
              likedBy: likedBy
            });
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            btn.classList.add("like-animate");
            setTimeout(() => btn.classList.remove("like-animate"), 400);
          }
        };
      });

      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.onclick = async () => {
          if (!currentUserName) {
            alert("ë¨¼ì € ìê¸°ì†Œê°œë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”!");
            return;
          }
          const commentId = btn.getAttribute("data-id");
          const commentRef = ref(db, "introductions/" + commentId);
          const snapshot = await get(commentRef);
          if (snapshot.exists()) {
            const data = snapshot.val();
            if (data.author !== currentUserName) {
              alert("ë³¸ì¸ë§Œ ì‚­ì œí•  ìˆ˜ ìˆì–´ìš”!");
              return;
            }
            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ì–´ìš”?")) {
              await remove(commentRef);
            }
          }
        };
      });
    });
  }

  // XSS ë°©ì§€ìš© ê°„ë‹¨ escape í•¨ìˆ˜
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[m];
    });
  }

  renderComments();
</script>

</body>
</html>

